<!DOCTYPE HTML>
<html>
<head>
  <link rel="stylesheet" href="../bower_components/webix/codebase/webix.css" type="text/css">
  <script src="bower_components/webix/codebase/webix.js" type="text/javascript"></script>
  <script src="bower_components/jquery/dist/jquery.js" type="text/javascript"></script>
</head>

<style>
  .standardDiv {
    background-color: rgb(97,91,90);
    font-size: 18px;
    color: white;
  }
</style>

<body>
  <script type="text/javascript" charset="utf-8">

  var currentKeys = {};

  webix.ready(function() {
    webix.message("App is loading, wait for confirmation");
    webix.ajax("http://127.0.0.1:5000/", function(response) {
        webix.message(response);
    });
  });

  var  resizer = {  view: "resizer"  } //This just makes it easier to add the resizer at different locations

  function runOCR(id) {
    webix.ajax("http://127.0.0.1:5000/runOCR?imagePath="+'label.jpg', function(response) {
      if(response.length > 0){
        $$("wbx_ocr").setValue(response);
      } else {
        webix.message('OCR didn\'t capture anything');
      }
    })
  };

  function createGroups(groups) {
    webix.message('nothing yet');
  }

  function runRegex(id) {
    ocr_output = $$('wbx_ocr').getValue();
    webix.ajax("http://127.0.0.1:5000/runRegex?ocr_output="+ocr_output+"&schema="+$$('schema_selector').getValue(), function(response) {
      currentKeys = JSON.parse(response);
      for (var key in currentKeys) {
        console.log(key);
      }
    })
  }

  myHeader = {
    cols: [
      {view: "template", type: "header", template: "Digital Slide Archive: Image OCR to QR code"},
      {view: "button", type: "form", click: runOCR, label:"RUN"}
    ]
  };

  // wbx_liveVideo = {
  //   rows: [
  //   {cols: [
  //     {view: "template", type: "header", template:"Live Video"},
  //     {view: "button", type: "form", label: "Capture Image",disabled: true}
  //     ]
  //   },
  //   {view: "template",
  //   id: "wbx_liveVideo",
  //   template: "<img id='liveVideo' src='label.jpg' >"}
  //   // maxWidth: 300}
  //   ]
  // }

  wbx_image = {
    view: "template", id: "wbx_image", template: "<img id='liveVideo' src='label.jpg' >", height:300
  }

  wbx_ocr = {
    view:"richtext", id:"wbx_ocr",labelPosition:"top", value:"", height:300
  }

  topRow = {
    cols: [wbx_image, wbx_ocr]  
  };

  function selectSchema(id) {
    for (var key in currentKeys) {
        // console.log(key);
        // console.log(key+"B");
        // $$("app").removeView(key+"B");
        $$("app").removeView(key);
    }
    ocr_output = $$('wbx_ocr').getValue();
    webix.ajax("http://127.0.0.1:5000/getGroups?&schema="+$$('schema_selector').getValue(), function(response) {
      for (var key in currentKeys) {
        $$("app")
      }
      
      currentKeys = JSON.parse(response);
      for (var key in currentKeys) {
        // console.log(key);
        // console.log(key+"B");
        $$("app").addView({
          id: key,
          cols: [
            {view:"button", label: "groupName", id: key+"B"},
            {view:"text", id: key}
          ]
        });
      }
    })
    // webix.ajax("http://127.0.0.1:5000/getGroups?schema="+id, function(response) {
    //   if (typeof response != 'string') {
    //     console.log(JSON.parse(response));
    //     $$("wbx_regexUpdates").addView({template:"New one"},2);
    // var pos = $$("app").index($$("schema_selector"));
    // for (var key in currentKeys) {
    //   $$("app").addView({view:"text", id:"text2"});
    // }

      // var data = JSON.parse(response);
      // console.log(data);
      // for (var key in data) {
      //   console.log(key);
      //   console.log(data[key])        
      // }
      // createGroups(data);
    // }
  }

  schema_selector = {
    view: "combo",
    css: "headerStyle",
    id: "schema_selector",
    label: "Select Schema:",
    labelWidth: 121,
    // value: "fox",
    options: ["fox", "fox2"],
    // maxHeight: 50
    on: { //allows attaching custom handlers to inner events of the component
      onChange: selectSchema
    }
    // on: {
    //   onChange: runRegex
    // }
  };  

  // botomRow = {}

  // wbx_regexOutput = {
  //   rows: [wbx_regexCombo,wbx_regexUpdates]
  // };

  // textRow = {
  //   cols: [wbx_currentOCR, wbx_regexOutput]
  // };
  
  //main ui
  webix.ui({
    id: 'app',
    rows: [
      myHeader,
      topRow,
      schema_selector
    ]
    //This ui is a 2 rows (first is just the header) with the last row being split into 2 columns.
    // cols: [ 
    //   {rows: [
    //     myHeader, //the simple header, this is static
    //     imageRow,
    //     wbx_currentOCR,
    //   ]},
    //   {rows:[wbx_regexCombo, wbx_regexUpdates]}
    // ]
  });
  </script>
</body>
</html>