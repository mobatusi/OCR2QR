<!DOCTYPE HTML>
<html>
<head>
    <title> DSA SlideSorter Helper</title>
    <link rel="stylesheet" href="http://cdn.webix.com/edge/webix.css" type="text/css">
    <script src="http://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
</head>

<style>
  .standardDiv {
    background-color: rgb(97,91,90);
    font-size: 18px;
    color: white;
  }
</style>

<body>
    <script type="text/javascript" charset="utf-8">
  var  FoxCollection_uid = '595d08b392ca9a000d0748df'
  var  resizer = {  view: "resizer"  }
  var  BaseURL = 'http://candygram.neurology.emory.edu:8080/api/v1/'

function selectFolder(id) {
                webix.message(id);
                var row = this.getPopup().getBody().getItem(id);
                console.log(row);

                $$("wbx_MainGrid").clearAll();
                $$("wbx_MainGrid").load( ListItemsInGirderFolder( row['_id'])  );
            };
/// Use Jquery to get the image    $("#myLabelImg").attr("src")  should update on click

//http://candygram.neurology.emory.edu:8080/api/v1/item?folderId=595d0b9b92ca9a000dd5691d&limit=50&sort=lowerName&sortdir=1

function ListItemsInGirderFolder( folderID)
                {
                url = BaseURL + 'item?folderId=' + folderID + "&sort=lowerName&limit=50&sortdir=1"
                return url
                };

//$$("mylayout").resize()

    myHeader = {
        view: "template",
        type: "header",
        template: "DSA SlideSorter Helper",
        css:"standardDiv"
    };


    url_GetFoxTopLevel_Folders = 'http://candygram.neurology.emory.edu:8080/api/v1/folder?parentType=collection&parentId=595d08b392ca9a000d0748df&limit=50&sort=lowerName&sortdir=1'
    ImageURL = "http://candygram.neurology.emory.edu:8080/api/v1/item/595b7b4292ca9a000d071697/tiles/images/";
    ImageBaseURL = "http://candygram.neurology.emory.edu:8080/api/v1/item/";
    thumbHeight = 300;

    wbx_FolderSelector = {
        view: "combo",
        id: "wbx_FolderSelector",
        label: "FoxFolders",
        on: {
            onChange: selectFolder,
        },
        options: {
            body: {
                template: "#name#"
            }
        },
    }


    webix.ready(function() {

        var list = $$("wbx_FolderSelector").getPopup().getList();
        list.clearAll();
        list.load(url_GetFoxTopLevel_Folders);


        //$$("wbx_FolderSelector").attachEvent("onAfterRender", function()
          //      {
            //        webix.message("DO SOMETHING!")
                    //this.getItem
              //   })


    });


    //ImageURL = "http://candygram.neurology.emory.edu:8080/api/v1/item/595b7b4292ca9a000d071697/tiles/images/"
    
    thumbHeight = 300;
    wbx_MyImageSet = {
        view: "template",
        id: "wbx_MyImageSet",
        template:"<img id='labelImg' src='" + ImageURL + "label?height=" + thumbHeight + "' >"
    }

    thumbHeight = 300;
    wbx_MyOcr = {
        view: "template",
        id: "wbx_MyOcr",
        template:"<img id='labelImg' src='" + ImageURL + "label?height=" + thumbHeight + "' >"
    }

    my_button = {
        view: "button",
        id: "my_button",
        value:"Display Text", 
        type:"form", 
        inputWidth:100 
    }

    /// Let's list the folders for the FOX Collection


    FoxFolderViewColList = [
        {id: "name", sort: "string"},
        {id: "size", sort: "int"},
        {id: "updated"},
        {id: "imageThumb", template: function(obj) {
            imgString = "<img src='" +BaseURL + "item/" + obj['_id'] + "/tiles/thumbnail?height=80&encoding=JPEG' >"
            return imgString
            },
        },
        { id: "StainType"},
        { id: "OCROutput"},
        { id: "OtherMetaData"}


    
    ]
    //inputImage = {
    //  view: "template",
    //  id: "inputImage",
    // autoConfig: true,
    //  template: "<img id='sampleImg' src='https://www.zachleat.com/web/wp-content/uploads/2011/01/Screen-shot-2011-01-11-at-7.37.54-PM.png'>"
    //} 

    //wbx_LeftMainPanel = {
    //    rows: [
        //    wbx_FolderSelector,
        //    wbx_MyImageSet,
           // resizer,

         //   {
              //  id: "wbx_LeftTopMainPanel",
            //    view: "datatable",
          //      autoConfig: true

        //    },

      //  ]
    //}
  //the left panel (not including the header)
  wbx_LeftMainPanel = {
    rows: [ wbx_FolderSelector, wbx_MyImageSet,resizer,my_button,wbx_MyOcr]
  }
wbx_MainGrid = 
    {
        view:"datatable",
        id: "wbx_MainGrid",
        autoConfig: true,
        columns: FoxFolderViewColList,
        rowHeight: 100,
        select: "row",
        on: { 
          "onItemClick": function(id){
            DataForCurrentRow =   this.getItem(id);
            currentImageURL = ImageBaseURL + DataForCurrentRow._id + "/tiles/images/label?height=" + thumbHeight
            // alert(currentImageURL)
            $("#labelImg").attr("src",currentImageURL);
          }
        },

    }


 wbx_RightMainPanel = {
        rows: [
            {view:"template", type:"header",template: "DataGrid"},
            wbx_MainGrid
        ]
    }

  

    webix.ui({
        rows: [
            myHeader, {
                cols: [
                    wbx_LeftMainPanel, wbx_RightMainPanel
                ]
            },
        ]

    });

    </script>
</body>

</html>
